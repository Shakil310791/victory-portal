<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Election Victory Celebration</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #ff8c66, #f0f0f0, #66cc66);
      animation: gradient 25s ease infinite;
      background-size: 200% 200%;
      position: relative;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      color: white;
    }
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    #watermark {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-45deg);
      font-size: 150px;
      font-weight: bold;
      color: rgba(255, 255, 255, 0.6);
      pointer-events: none;
      z-index: -1;
    }
    #dance-video {
      width: 400px;
      height: 400px;
      display: none;
      position: relative;
      filter: drop-shadow(0 0 15px #ff0);
      z-index: 10;
    }
    #wishes-container {
      max-height: 300px;
      overflow-y: auto;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
      padding: 1.5rem;
      width: 100%;
      max-width: 28rem;
    }
    .neon-text {
      text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px #ff0, 0 0 30px #ff0;
    }
    button {
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    button:hover {
      transform: scale(1.1);
      box-shadow: 0 0 15px #ff0;
    }
    #badge-canvas {
      border: 4px solid #ff0;
      border-radius: 10px;
    }
    img, iframe {
      max-width: 100%;
      height: auto;
    }
    .media-container {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    .winner-photo {
      max-width: 300px;
    }
    .mb-4 { margin-bottom: 1rem; }
    .mb-6 { margin-bottom: 1.5rem; }
    .mb-8 { margin-bottom: 2rem; }
    .text-center { text-align: center; }
    .text-5xl { font-size: 3rem; }
    .text-2xl { font-size: 1.5rem; }
    .text-xl { font-size: 1.25rem; }
    .text-lg { font-size: 1.125rem; }
    .font-extrabold { font-weight: 800; }
    .font-semibold { font-weight: 600; }
    .font-bold { font-weight: 700; }
    .text-black { color: #000; }
    .text-white { color: #fff; }
    .text-yellow-200 { color: #fef08a; }
    .bg-yellow-400 { background-color: #facc15; }
    .bg-blue-600 { background-color: #2563eb; }
    .bg-red-600 { background-color: #dc2626; }
    .bg-green-600 { background-color: #16a34a; }
    .bg-purple-600 { background-color: #9333ea; }
    .hover\:bg-yellow-500:hover { background-color: #eab308; }
    .hover\:bg-blue-700:hover { background-color: #1d4ed8; }
    .hover\:bg-red-700:hover { background-color: #b91c1c; }
    .hover\:bg-green-700:hover { background-color: #15803d; }
    .hover\:bg-purple-700:hover { background-color: #7e22ce; }
    .p-3 { padding: 0.75rem; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
    .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
    .rounded-lg { border-radius: 0.5rem; }
    .border-4 { border-width: 4px; }
    .border-yellow-400 { border-color: #facc15; }
    .shadow-2xl { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
    .w-full { width: 100%; }
    .max-w-md { max-width: 28rem; }
    .mx-auto { margin-left: auto; margin-right: auto; }
    .mt-3 { margin-top: 0.75rem; }
    .mr-2 { margin-right: 0.5rem; }
    .mr-4 { margin-right: 1rem; }
    .hidden { display: none; }
    .focus\:outline-none:focus { outline: none; }
    .focus\:ring-2:focus { box-shadow: 0 0 0 2px; }
    .focus\:ring-yellow-400:focus { box-shadow: 0 0 0 2px #facc15; }
  </style>
</head>
<body>
  <div id="watermark">Ekta Pariwar</div>
  <div class="text-center p-8 max-w-3xl w-full relative">
    <h1 class="text-5xl font-extrabold mb-4 neon-text">Congratulations, [Your Friend's Name]!</h1>
    <div class="media-container">
      <img src="https://i.imgur.com/j2nPNc3.jpeg?t=${Date.now()}" alt="Winner Photo" class="winner-photo rounded-xl shadow-2xl border-4 border-yellow-400" onerror="this.src='https://via.placeholder.com/300x200?text=Winner+Photo'; console.error('Failed to load winner photo:', this.src)">
      <iframe id="dance-video" src="https://player.vimeo.com/video/1105391428?autoplay=0&muted=0" width="400" height="400" frameborder="0" allow="autoplay; fullscreen" allowfullscreen class="hidden"></iframe>
    </div>
    <p class="text-xl mb-4 neon-text">Celebrating your legendary victory in the election! Let's light up the sky!</p>
    <p class="text-lg mb-6">Celebrations so far: <span id="celebration-count" class="font-bold">0</span></p>

    <div class="mb-8">
      <button id="celebrate-btn" class="bg-yellow-400 text-black px-6 py-3 rounded-lg font-semibold hover:bg-yellow-500 mr-4">Light Up Fireworks & Dance!</button>
    </div>

    <div class="mb-8">
      <h2 class="text-2xl font-semibold mb-3 neon-text">Record Your Victory Wish</h2>
      <button id="record-btn" class="bg-blue-600 px-4 py-2 rounded-lg hover:bg-blue-700 mr-2">Start Recording</button>
      <button id="stop-btn" class="bg-red-600 px-4 py-2 rounded-lg hover:bg-red-700 hidden">Stop Recording</button>
      <p id="recording-status" class="mt-3 text-lg"></p>
      <audio id="audio-playback" controls class="mt-3 hidden mx-auto"></audio>
      <a id="download-link" class="text-yellow-200 underline hidden mt-3">Download Your Wish</a>
    </div>

    <div class="mb-8">
      <h2 class="text-2xl font-semibold mb-3 neon-text">Share Your Wish</h2>
      <input id="wish-input" type="text" placeholder="Type your wish here..." class="text-black p-3 rounded-lg w-full max-w-md focus:outline-none focus:ring-2 focus:ring-yellow-400 mb-3">
      <button id="submit-wish" class="bg-green-600 px-4 py-2 rounded-lg hover:bg-green-700 mr-2">Submit Wish</button>
      <button id="add-crown" class="bg-purple-600 px-4 py-2 rounded-lg hover:bg-purple-700">Add Victory Crown</button>
      <canvas id="badge-canvas" width="300" height="200" class="mt-3 mx-auto"></canvas>
      <a id="download-crown" class="text-yellow-200 underline hidden mt-3">Download Crowned Photo</a>
    </div>

    <div id="wishes-container" class="text-black">
      <h2 class="text-xl font-semibold mb-3">Wishes from Friends</h2>
      <div id="wishes-list"></div>
    </div>
  </div>

  <script>
    // Initial Confetti on Page Load
    console.log('Page loaded, firing initial confetti');
    confetti({
      particleCount: 50,
      spread: 60,
      origin: { y: 0.6 }
    });

    // Fireworks and Dance
    const celebrateBtn = document.getElementById('celebrate-btn');
    const danceVideo = document.getElementById('dance-video');
    const celebrationCount = document.getElementById('celebration-count');
    let count = 0;

    celebrateBtn.addEventListener('click', () => {
      console.log('Celebrate button clicked');
      // Realistic Fireworks
      function launchFireworks() {
        console.log('Launching fireworks');
        confetti({
          particleCount: 150,
          spread: 120,
          origin: { y: Math.random() },
          colors: ['#ff0', '#f00', '#0f0', '#00f', '#fff'],
          shapes: ['circle', 'square', 'star'],
          scalar: 1.5
        });
      }
      launchFireworks();
      const interval = setInterval(launchFireworks, 400);
      setTimeout(() => {
        console.log('Stopping fireworks');
        clearInterval(interval);
      }, 3000);

      // Dance Video (Iframe)
      console.log('Showing dance video');
      danceVideo.style.display = 'block';
      const baseSrc = 'https://player.vimeo.com/video/1105391428';
      danceVideo.src = `${baseSrc}?autoplay=1&muted=0`;
      // No setTimeout to let the video play fully
      danceVideo.onerror = () => {
        console.error('Failed to load video:', danceVideo.src);
      };
    });

    // Load Celebration Count
    if (localStorage.getItem('celebrationCount')) {
      count = parseInt(localStorage.getItem('celebrationCount'));
      celebrationCount.textContent = count;
      console.log('Loaded celebration count:', count);
    }

    // Voice Recording
    let mediaRecorder;
    let recordedChunks = [];
    const recordBtn = document.getElementById('record-btn');
    const stopBtn = document.getElementById('stop-btn');
    const recordingStatus = document.getElementById('recording-status');
    const audioPlayback = document.getElementById('audio-playback');
    const downloadLink = document.getElementById('download-link');

    recordBtn.addEventListener('click', async () => {
      console.log('Start recording clicked');
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.start();
        recordBtn.classList.add('hidden');
        stopBtn.classList.remove('hidden');
        recordingStatus.textContent = 'Recording...';
        console.log('Recording started');
        mediaRecorder.ondataavailable = (e) => {
          recordedChunks.push(e.data);
        };
        mediaRecorder.onstop = () => {
          console.log('Recording stopped');
          const blob = new Blob(recordedChunks, { type: 'audio/ogg; codecs=opus' });
          recordedChunks = [];
          const url = URL.createObjectURL(blob);
          audioPlayback.src = url;
          audioPlayback.classList.remove('hidden');
          downloadLink.href = url;
          downloadLink.download = 'wish-recording.ogg';
          downloadLink.classList.remove('hidden');
          recordingStatus.textContent = 'Recording stopped. Play or download your wish!';
        };
      } catch (err) {
        recordingStatus.textContent = 'Microphone access denied. Please allow access.';
        console.error('Recording failed:', err.message);
      }
    });

    stopBtn.addEventListener('click', () => {
      console.log('Stop recording clicked');
      mediaRecorder.stop();
      recordBtn.classList.remove('hidden');
      stopBtn.classList.add('hidden');
    });

    // Victory Crown Generator
    const badgeCanvas = document.getElementById('badge-canvas');
    const ctx = badgeCanvas.getContext('2d');
    const addCrown = document.getElementById('add-crown');
    const downloadCrown = document.getElementById('download-crown');
    const img = new Image();
    img.src = `https://i.imgur.com/j2nPNc3.jpeg?t=${Date.now()}`;
    img.onerror = () => {
      console.error('Failed to load winner photo:', img.src);
      img.src = 'https://via.placeholder.com/300x200?text=Winner+Photo';
      ctx.drawImage(img, 0, 0, 300, 200);
    };
    img.onload = () => {
      console.log('Winner photo loaded');
      ctx.drawImage(img, 0, 0, 300, 200);
    };

    addCrown.addEventListener('click', () => {
      console.log('Add crown clicked');
      ctx.drawImage(img, 0, 0, 300, 200);
      ctx.fillStyle = '#ff0';
      ctx.font = 'bold 40px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('VICTORY!', 150, 180);
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 3;
      ctx.strokeText('VICTORY!', 150, 180);
      // Draw a simple crown
      ctx.beginPath();
      ctx.moveTo(100, 50);
      ctx.lineTo(120, 30);
      ctx.lineTo(140, 50);
      ctx.lineTo(160, 30);
      ctx.lineTo(180, 50);
      ctx.lineTo(200, 30);
      ctx.lineTo(220, 50);
      ctx.fillStyle = '#ffd700';
      ctx.fill();
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 2;
      ctx.stroke();
      downloadCrown.href = badgeCanvas.toDataURL('image/png');
      downloadCrown.download = 'victory-crown.png';
      downloadCrown.classList.remove('hidden');
      console.log('Crown added, download link enabled');
    });

    // Wishes Submission
    const wishInput = document.getElementById('wish-input');
    const submitWish = document.getElementById('submit-wish');
    const wishesList = document.getElementById('wishes-list');
    let wishes = JSON.parse(localStorage.getItem('wishes')) || [];

    function displayWishes() {
      wishesList.innerHTML = wishes.map(wish => `<p class="border-b py-2 text-black">${wish}</p>`).join('');
      console.log('Wishes displayed:', wishes);
    }

    submitWish.addEventListener('click', () => {
      console.log('Submit wish clicked');
      const wish = wishInput.value.trim();
      if (wish) {
        wishes.push(wish);
        localStorage.setItem('wishes', JSON.stringify(wishes));
        wishInput.value = '';
        displayWishes();
      }
    });

    displayWishes();

    // Error Handling for Media
    const images = document.querySelectorAll('img');
    images.forEach(img => {
      img.onerror = () => {
        console.error(`Failed to load image: ${img.src}`);
        img.src = `https://via.placeholder.com/300x200?text=${img.alt.replace(' ', '+')}`;
      };
    });
  </script>
</body>
</html>